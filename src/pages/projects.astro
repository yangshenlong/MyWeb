---
import BaseHead from '../components/BaseHead.astro';
import HeaderArchitectural from '../components/HeaderArchitectural.astro';
import ProjectGridArchitectural from '../components/ProjectGridArchitectural.astro';
import BackToTop from '../components/BackToTop.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import SkipLink from '../components/SkipLink.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const allProjects = [
	{
		title: 'Water Shader System',
		category: 'Shader Development',
		year: '2024',
		description: '基于Gerstner波的实时水面渲染系统，支持波浪模拟、反射折射和泡沫效果。',
		tags: ['HLSL', 'Unity', 'URP', 'Water Simulation'],
		link: '#'
	},
	{
		title: 'Maya Auto UV Tool',
		category: 'Tool Development',
		year: '2024',
		description: '使用Python和PyQt开发的Maya自动化工具，智能UV展开算法，效率提升80%。',
		tags: ['Python', 'Maya API', 'PyQt', 'UV Unwrap'],
		link: '#'
	},
	{
		title: 'Volumetric GI System',
		category: 'Rendering',
		year: '2023',
		description: '基于Voxel Cone Tracing的实时全局光照解决方案，支持动态光源。',
		tags: ['Compute Shader', 'GI', 'Unity', 'Optimization'],
		link: '#'
	},
	{
		title: 'Custom Render Pipeline',
		category: 'Pipeline',
		year: '2023',
		description: '定制的渲染管线，包含Deferred Rendering、SSAO、SSR和体积光。',
		tags: ['Render Pipeline', 'Deferred', 'Post-Processing'],
		link: '#'
	},
	{
		title: 'Procedural Vegetation',
		category: 'Procedural',
		year: '2023',
		description: '基于Houdini Engine的程序化植被生成系统，支持风场动画。',
		tags: ['Houdini', 'Unity', 'Instancing', 'Vegetation'],
		link: '#'
	},
	{
		title: 'Shader Debugger',
		category: 'Tools',
		year: '2023',
		description: '实时Shader预览和性能分析工具，大幅提升开发效率。',
		tags: ['Editor Tools', 'Shader', 'Debug', 'Performance'],
		link: '#'
	},
	{
		title: 'Dissolve Effect',
		category: 'VFX',
		year: '2022',
		description: '可自定义的消融效果Shader，支持边缘发光和粒子发射。',
		tags: ['VFX', 'Shader', 'Dissolve', 'Particles'],
		link: '#'
	},
	{
		title: 'Toon Rendering',
		category: 'Stylized',
		year: '2022',
		description: '卡通渲染着色器系统，支持Ramp贴图和轮廓线。',
		tags: ['NPR', 'Toon', 'Cel Shading', 'Stylized'],
		link: '#'
	}
];

// Extract all unique categories
const allCategories = Array.from(new Set(allProjects.map(p => p.category)));
const categoryCounts = allCategories.map(category => ({
	category,
	count: allProjects.filter(p => p.category === category).length
}));
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Work | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />

		<style>
			.page-header {
				padding: 180px 4em 6em;
				background: var(--color-bg-primary);
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				max-width: 1600px;
				margin: 0 auto;
			}

			.page-content {
				max-width: 1600px;
				margin: 0 auto;
			}

			.category-filter {
				display: flex;
				gap: 1em;
				flex-wrap: wrap;
				margin-bottom: 4em;
				padding-bottom: 2em;
				border-bottom: 1px solid var(--border-subtle);
			}

			.category-btn {
				position: relative;
				display: flex;
				align-items: center;
				gap: 0.75em;
				padding: 0.75em 1.5em;
				background: rgba(255, 255, 255, 0.03);
				backdrop-filter: blur(10px);
				border: 1px solid var(--border-subtle);
				border-radius: var(--radius-full);
				font-size: 0.85em;
				color: var(--color-text-secondary);
				cursor: pointer;
				transition: all 0.3s ease;
				overflow: hidden;
			}

			.category-btn::before {
				content: '';
				position: absolute;
				top: 0;
				left: -100%;
				width: 100%;
				height: 100%;
				background: linear-gradient(
					90deg,
					transparent,
					rgba(255, 255, 255, 0.05),
					transparent
				);
				transition: left 0.4s ease;
			}

			.category-btn:hover {
				background: rgba(255, 255, 255, 0.08);
				border-color: var(--border-hover);
				color: var(--color-text-primary);
				transform: translateY(-2px);
			}

			.category-btn:hover::before {
				left: 100%;
			}

			.category-btn.active {
				background: linear-gradient(
					135deg,
					rgba(var(--color-accent-primary), 0.2),
					rgba(var(--color-accent-secondary), 0.15)
				);
				border-color: rgba(var(--color-accent-primary), 0.4);
				color: rgba(255, 255, 255, 0.95);
			}

			.category-btn.active::after {
				content: '';
				position: absolute;
				bottom: -1px;
				left: 50%;
				transform: translateX(-50%);
				width: 20px;
				height: 3px;
				background: linear-gradient(90deg, #6366f1, #a855f7);
				border-radius: 2px;
			}

			.category-count {
				font-size: 0.75em;
				color: var(--color-text-muted);
				font-family: var(--font-mono);
				padding: 0.2em 0.6em;
				background: rgba(255, 255, 255, var(--glass-opacity-bg-hover));
				border-radius: var(--radius-full);
				transition: all 0.3s ease;
			}

			.category-btn.active .category-count {
				color: rgba(255, 255, 255, 0.8);
				background: rgba(99, 102, 241, 0.2);
			}

			.header-content {
				flex: 1;
			}

			.breadcrumb {
				display: flex;
				align-items: center;
				gap: 0.75em;
				margin-bottom: 1.5em;
			}

			.breadcrumb-item {
				font-size: 0.75em;
				letter-spacing: 0.2em;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.4);
				transition: color 0.3s ease;
			}

			.breadcrumb-item:hover {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-item.current {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-separator {
				color: rgba(255, 255, 255, 0.2);
			}

			.page-title {
				font-size: clamp(3em, 8vw, 6em);
				font-weight: 200;
				letter-spacing: -0.03em;
				line-height: 1;
				margin: 0 0 0.5em 0;
			}

			.page-subtitle {
				font-size: 1em;
				letter-spacing: 0.2em;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.4);
				margin: 0;
			}

			.header-decoration {
				position: relative;
			}

			.deco-number {
				font-size: 8em;
				font-weight: 100;
				color: rgba(255, 255, 255, 0.03);
				font-family: 'Space Mono', monospace;
				line-height: 1;
			}

			@media (max-width: 1024px) {
				.page-header {
					padding: 180px 2em 4em;
					flex-direction: column;
					gap: 2em;
				}

				.header-decoration {
					align-self: flex-end;
				}

				.deco-number {
					font-size: 4em;
				}
			}

			@media (max-width: 768px) {
				.page-header {
					padding: 120px 2em 4em;
					flex-direction: column;
					gap: 2em;
					text-align: center;
				}

				.page-title {
					font-size: 2.5em;
				}

				.header-decoration {
					display: none;
				}

				.category-filter {
					justify-content: center;
				}

				.category-btn {
					flex: 1 0 auto;
					min-width: 120px;
				}
			}
		</style>
	</head>

	<body>
		<ScrollProgress />
		<SkipLink />
		<HeaderArchitectural />

		<!-- Page Header -->
		<section class="page-header">
			<div class="header-content">
				<div class="breadcrumb">
					<span class="breadcrumb-item">
						<a href="/">首页</a>
					</span>
					<span class="breadcrumb-separator">/</span>
					<span class="breadcrumb-item current">作品</span>
				</div>
				<h1 class="page-title">全部作品</h1>
				<p class="page-subtitle">All Projects</p>
			</div>
			<div class="header-decoration">
				<span class="deco-number">02</span>
			</div>
		</section>

		<!-- Projects Grid -->
		<section class="page-content">
			<!-- Category Filter -->
			<div class="category-filter">
				<button class="category-btn active" data-category="all">
					全部
					<span class="category-count">{allProjects.length}</span>
				</button>
				{categoryCounts.map(cat => (
					<button class="category-btn" data-category={cat.category}>
						{cat.category}
						<span class="category-count">{cat.count}</span>
					</button>
				))}
			</div>

			<ProjectGridArchitectural projects={allProjects} />
		</section>

		<!-- Footer -->
		<Footer />

		<BackToTop />

		<script>
			// Category filter functionality
			const filterButtons = document.querySelectorAll('.category-btn');
			const projectItems = document.querySelectorAll('.project-item');

			filterButtons.forEach(btn => {
				btn.addEventListener('click', () => {
					const category = (btn as HTMLElement).dataset.category || 'all';

					filterButtons.forEach(b => b.classList.remove('active'));
					btn.classList.add('active');

					projectItems.forEach(item => {
						const projectEl = item as HTMLElement;
						const itemCategory = projectEl.dataset.category || '';

						if (category === 'all' || itemCategory === category) {
							projectEl.style.display = '';
						} else {
							projectEl.style.display = 'none';
						}
					});
				});
			});
		</script>
	</body>
</html>

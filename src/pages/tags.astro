---
import HeaderArchitectural from '../components/HeaderArchitectural.astro';
import GlassCard from '../components/GlassCard.astro';
import BackToTop from '../components/BackToTop.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import { getCollection } from 'astro:content';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

// 获取所有博客文章
const allPosts = await getCollection('blog');

// 提取所有标签并统计
const tagCounts = new Map<string, number>();
allPosts.forEach(post => {
	const tags = post.data.tags || [];
	tags.forEach(tag => {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	});
});

// 按标签名称排序
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) =>
	a[0].localeCompare(b[0], 'zh-CN')
);

// 计算最大计数用于标签云大小
const maxCount = Math.max(...Array.from(tagCounts.values()));
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>标签 | {SITE_TITLE}</title>
		<meta name="description" content={SITE_DESCRIPTION} />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&family=Space+Mono:wght@400;500&display=swap" rel="stylesheet" />

		<style is:global>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
				background: #050505;
				color: rgba(255, 255, 255, 0.9);
				line-height: 1.6;
			}

			a {
				color: inherit;
				text-decoration: none;
			}
		</style>
	</head>

	<body>
		<ScrollProgress />
		<HeaderArchitectural />

		<!-- Page Header -->
		<section class="page-header">
			<div class="header-content">
				<div class="breadcrumb">
					<span class="breadcrumb-item">
						<a href="/">首页</a>
					</span>
					<span class="breadcrumb-separator">/</span>
					<span class="breadcrumb-item current">标签</span>
				</div>
				<h1 class="page-title">文章标签</h1>
				<p class="page-subtitle">Tags</p>
			</div>
			<div class="header-decoration">
				<span class="deco-number">04</span>
			</div>
		</section>

		<!-- Tags Cloud Section -->
		<section class="tags-section">
			<div class="tags-container">
				<GlassCard class="tags-cloud-card">
					<div class="tags-header">
						<h2>标签云</h2>
						<p class="tags-count">共 {sortedTags.length} 个标签</p>
					</div>
					<div class="tags-cloud">
						{sortedTags.map(([tag, count], index) => {
							const sizeRatio = count / maxCount;
							const fontSize = 0.85 + sizeRatio * 0.7; // 0.85em ~ 1.55em
							const opacity = 0.5 + sizeRatio * 0.4; // 0.5 ~ 0.9
							return (
								<a
									href={`/tags/${encodeURIComponent(tag)}`}
									class="tag-item"
									style={`--font-size: ${fontSize}em; --opacity: ${opacity}; --delay: ${index * 30}ms`}
								>
									<span class="tag-name">{tag}</span>
									<span class="tag-count">{count}</span>
								</a>
							);
						})}
					</div>
				</GlassCard>

				<!-- Tags List -->
				<div class="tags-list">
					{sortedTags.map(([tag, count]) => (
						<a href={`/tags/${encodeURIComponent(tag)}`} class="tag-list-item">
							<GlassCard class="tag-list-card">
								<div class="tag-list-info">
									<span class="tag-list-name">{tag}</span>
									<span class="tag-list-count">{count} 篇文章</span>
								</div>
								<span class="tag-list-arrow">→</span>
							</GlassCard>
						</a>
					))}
				</div>
			</div>
		</section>

		<!-- Footer -->
		<footer class="arch-footer">
			<div class="footer-content">
				<div class="footer-left">
					<span class="footer-text">© 2024 杨慎龙</span>
					<span class="footer-divider">·</span>
					<span class="footer-text">Technical Artist</span>
				</div>
				<div class="footer-right">
					<a href="https://github.com/yangshenlong" target="_blank" class="footer-link">GitHub</a>
					<a href="#" target="_blank" class="footer-link">Bilibili</a>
					<a href="#" target="_blank" class="footer-link">知乎</a>
				</div>
			</div>
		</footer>

		<BackToTop />

		<style>
			.page-header {
				padding: 180px 4em 6em;
				background: #050505;
				position: relative;
				display: flex;
				align-items: center;
				justify-content: space-between;
				max-width: 1600px;
				margin: 0 auto;
			}

			.header-content {
				flex: 1;
			}

			.breadcrumb {
				display: flex;
				align-items: center;
				gap: 0.75em;
				margin-bottom: 1.5em;
			}

			.breadcrumb-item {
				font-size: 0.75em;
				letter-spacing: 0.2em;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.4);
				transition: color 0.3s ease;
			}

			.breadcrumb-item:hover {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-item.current {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-separator {
				color: rgba(255, 255, 255, 0.2);
			}

			.page-title {
				font-size: clamp(3em, 8vw, 6em);
				font-weight: 200;
				letter-spacing: -0.03em;
				line-height: 1;
				margin: 0 0 0.5em 0;
			}

			.page-subtitle {
				font-size: 1em;
				letter-spacing: 0.2em;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.4);
				margin: 0;
			}

			.header-decoration {
				position: relative;
			}

			.deco-number {
				font-size: 8em;
				font-weight: 100;
				color: rgba(255, 255, 255, 0.03);
				font-family: 'Space Mono', monospace;
				line-height: 1;
			}

			/* Tags Section */
			.tags-section {
				padding: 6em 4em;
				background: #050505;
			}

			.tags-container {
				max-width: 1000px;
				margin: 0 auto;
			}

			.tags-cloud-card {
				padding: 3em;
				margin-bottom: 3em;
			}

			.tags-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 2em;
				padding-bottom: 1.5em;
				border-bottom: 1px solid rgba(255, 255, 255, 0.06);
			}

			.tags-header h2 {
				font-size: 1.5em;
				font-weight: 300;
				letter-spacing: -0.02em;
				color: rgba(255, 255, 255, 0.95);
				margin: 0;
			}

			.tags-count {
				font-size: 0.85em;
				color: rgba(255, 255, 255, 0.5);
				font-family: 'Space Mono', monospace;
				letter-spacing: 0.1em;
			}

			.tags-cloud {
				display: flex;
				flex-wrap: wrap;
				gap: 1em 1.5em;
				justify-content: center;
			}

			.tag-item {
				display: inline-flex;
				align-items: center;
				gap: 0.5em;
				padding: 0.5em 1em;
				background: rgba(255, 255, 255, 0.05);
				border: 1px solid rgba(255, 255, 255, 0.08);
				border-radius: 4px;
				transition: all 0.3s ease;
				animation: fadeIn 0.4s ease-out backwards;
				animation-delay: var(--delay);
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: scale(0.9);
				}
				to {
					opacity: var(--opacity);
					transform: scale(1);
				}
			}

			.tag-item:hover {
				background: rgba(255, 255, 255, 0.1);
				border-color: rgba(255, 255, 255, 0.15);
				transform: translateY(-2px);
			}

			.tag-name {
				font-size: var(--font-size);
				opacity: var(--opacity);
				transition: opacity 0.3s ease;
			}

			.tag-count {
				font-size: 0.7em;
				color: rgba(255, 255, 255, 0.4);
				font-family: 'Space Mono', monospace;
				padding: 0.2em 0.5em;
				background: rgba(255, 255, 255, 0.05);
				border-radius: 2px;
			}

			/* Tags List */
			.tags-list {
				display: flex;
				flex-direction: column;
				gap: 1em;
			}

			.tag-list-item {
				display: block;
			}

			.tag-list-card {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 1.5em 2em;
				transition: all 0.3s ease;
			}

			.tag-list-card:hover {
				background: rgba(255, 255, 255, 0.05);
				transform: translateX(8px);
			}

			.tag-list-info {
				display: flex;
				flex-direction: column;
				gap: 0.25em;
			}

			.tag-list-name {
				font-size: 1.1em;
				font-weight: 400;
				color: rgba(255, 255, 255, 0.95);
			}

			.tag-list-count {
				font-size: 0.8em;
				color: rgba(255, 255, 255, 0.5);
				font-family: 'Space Mono', monospace;
			}

			.tag-list-arrow {
				font-size: 1.5em;
				color: rgba(255, 255, 255, 0.3);
				transition: all 0.3s ease;
			}

			.tag-list-item:hover .tag-list-arrow {
				color: rgba(255, 255, 255, 0.6);
				transform: translateX(4px);
			}

			/* Footer styles moved to Footer.astro component */

			/* Responsive */
			@media (max-width: 1024px) {
				.page-header,
				.tags-section {
					padding-left: 2em;
					padding-right: 2em;
				}

				.page-header {
					flex-direction: column;
					gap: 2em;
				}

				.header-decoration {
					align-self: flex-end;
				}

				.deco-number {
					font-size: 4em;
				}

				.tags-cloud-card {
					padding: 2em;
				}
			}

			@media (max-width: 768px) {
				.footer-content {
					flex-direction: column;
					gap: 1.5em;
					text-align: center;
				}

				.footer-left {
					flex-direction: column;
					gap: 0.5em;
				}

				.footer-right {
					gap: 1.5em;
				}

				.tags-header {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.5em;
				}

				.tag-list-card {
					padding: 1em 1.5em;
				}
			}
		</style>
	</body>
</html>

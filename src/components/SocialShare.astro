---
/**
 * 社交分享组件
 * 支持多平台分享和复制链接
 */

interface Props {
	title: string;
	description: string;
	url?: string;
	showLabels?: boolean;
	orientation?: 'horizontal' | 'vertical';
}

const {
	title,
	description,
	url = '',
	showLabels = true,
	orientation = 'horizontal',
} = Astro.props;

// 获取当前页面 URL
const shareUrl = url || Astro.url.href;

// 分享平台配置
const platforms = [
	{
		name: 'Twitter',
		icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
			<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
		</svg>`,
		getShareUrl: (url: string, title: string, _description: string) =>
			`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`,
		color: '#000000',
	},

	{
		name: 'Facebook',
		icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
			<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
		</svg>`,
		getShareUrl: (url: string, _title: string, _description: string) =>
			`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
		color: '#1877F2',
	},

	{
		name: 'LinkedIn',
		icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
			<path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
		</svg>`,
		getShareUrl: (url: string, title: string, description: string) =>
			`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}&summary=${encodeURIComponent(description)}`,
		color: '#0A66C2',
	},

	{
		name: '复制链接',
		icon: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
			<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
			<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
		</svg>`,
		action: 'copy',
		color: 'currentColor',
	},
];
---

<div class="social-share" data-orientation={orientation}>
	<div class="share-label">分享</div>

	<div class="share-platforms">
		{platforms.map((platform) => (
			platform.action === 'copy' ? (
				<button
					class="share-button copy-button"
					title={platform.name}
					data-copy-url={shareUrl}
				>
					<span class="button-icon" style={`--platform-color: ${platform.color}`}>
						{platform.icon}
					</span>
					{showLabels && (
						<span class="button-label">{platform.name}</span>
					)}
				</button>
			) : (
				<a
					href={platform.getShareUrl(shareUrl, title, description)}
					class="share-button"
					target="_blank"
					rel="noopener noreferrer"
					title={platform.name}
					aria-label={`Share on ${platform.name}`}
				>
					<span class="button-icon" style={`--platform-color: ${platform.color}`}>
						{platform.icon}
					</span>
					{showLabels && (
						<span class="button-label">{platform.name}</span>
					)}
				</a>
			)
		))}
	</div>
</div>

<script>
	// 复制链接功能
	const copyButton = document.querySelector('.copy-button');

	if (copyButton) {
		copyButton.addEventListener('click', async () => {
			const url = copyButton.getAttribute('data-copy-url');

			if (!url) return;

			try {
				await navigator.clipboard.writeText(url);

				// 显示成功状态
				const originalContent = copyButton.innerHTML;
				copyButton.classList.add('copied');
				copyButton.innerHTML = `
					<span class="button-icon">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="20 6 9 17 4 12"></polyline>
						</svg>
					</span>
					${copyButton.querySelector('.button-label') ? '<span class="button-label">已复制</span>' : ''}
				`;

				// 2秒后恢复
				setTimeout(() => {
					copyButton.classList.remove('copied');
					copyButton.innerHTML = originalContent;
				}, 2000);
			} catch (error) {
				console.error('复制失败:', error);
			}
		});
	}
</script>

<style>
	.social-share {
		display: flex;
		align-items: center;
		gap: 1em;
	}

	.social-share[data-orientation='vertical'] {
		flex-direction: column;
		align-items: flex-start;
	}

	.share-label {
		font-size: 0.85em;
		font-weight: 500;
		color: var(--color-text-secondary);
		margin-right: 0.5em;
	}

	.social-share[data-orientation='vertical'] .share-label {
		margin-bottom: 0.75em;
		margin-right: 0;
	}

	.share-platforms {
		display: flex;
		gap: 0.5em;
	}

	.social-share[data-orientation='vertical'] .share-platforms {
		flex-direction: column;
	}

	.share-button {
		display: flex;
		align-items: center;
		gap: 0.5em;
		padding: 0.6em 1em;
		background: rgba(255, 255, 255, var(--glass-opacity-bg-hover));
		border: 1px solid var(--border-standard);
		border-radius: 8px;
		color: var(--color-text-secondary);
		text-decoration: none;
		font-size: 0.85em;
		cursor: pointer;
		transition: all var(--transition-base);
	}

	.share-button:hover {
		background: rgba(255, 255, 255, 0.08);
		border-color: var(--border-hover);
		color: var(--color-text-primary);
		transform: translateY(-2px);
		box-shadow: var(--shadow-sm);
	}

	.share-button.copied {
		background: rgba(34, 197, 94, 0.1);
		border-color: rgba(34, 197, 94, 0.3);
		color: rgb(34, 197, 94);
	}

	.button-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		color: var(--platform-color);
		transition: transform var(--transition-base);
	}

	.share-button:hover .button-icon {
		transform: scale(1.1);
	}

	.button-label {
		font-weight: 500;
	}

	/* 响应式 */
	@media (max-width: 768px) {
		.share-label {
			display: none;
		}

		.button-label {
			display: none;
		}
	}

	/* 无障碍 */
	@media (prefers-reduced-motion: reduce) {
		.share-button,
		.button-icon {
			transition: none;
		}
	}
</style>

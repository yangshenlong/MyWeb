---
/**
 * 页面过渡动画组件
 * 提供平滑的页面加载和过渡效果
 */

interface Props {
	delay?: number;
}

const { delay = 0 } = Astro.props;
---

<div class="page-transition" id="pageTransition">
	<div class="transition-overlay"></div>
	<div class="transition-content">
		<div class="loading-bar"></div>
	</div>
</div>

<style>
	.page-transition {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		pointer-events: none;
		z-index: 9999;
		opacity: 0;
		transition: opacity 0.3s ease;
	}

	.page-transition.active {
		opacity: 1;
		pointer-events: all;
	}

	.transition-overlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: var(--color-bg-primary);
		transform: scaleY(0);
		transform-origin: bottom;
		transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.page-transition.active .transition-overlay {
		transform: scaleY(1);
	}

	.transition-content {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 200px;
	}

	.loading-bar {
		width: 100%;
		height: 2px;
		background: var(--border-hover);
		overflow: hidden;
	}

	.loading-bar::after {
		content: '';
		display: block;
		width: 30%;
		height: 100%;
		background: rgba(255, 255, 255, 0.9);
		animation: loading 1.5s ease-in-out infinite;
	}

	@keyframes loading {
		0% {
			transform: translateX(-100%);
		}
		100% {
			transform: translateX(400%);
		}
	}
</style>

<script define:vars={{ delay }}>
	// 页面加载完成后隐藏过渡
	window.addEventListener('load', () => {
		setTimeout(() => {
			const transition = document.getElementById('pageTransition');
			if (transition) {
				transition.classList.add('hide');
				setTimeout(() => {
					transition.classList.remove('active');
				}, 300);
			}
		}, delay);
	});
</script>

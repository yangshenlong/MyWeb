---
/**
 * 视差滚动区域组件
 * 子元素根据滚动速度产生不同深度的移动效果
 */

interface Props {
  class?: string;
  speed?: number;
}

const { class: className, speed = 0.5 } = Astro.props;
---

<div class:list={["parallax-section", className]} data-speed={speed}>
  <slot />
</div>

<style>
  .parallax-section {
    position: relative;
    will-change: transform;
    transition: transform 0.1s ease-out;
  }
</style>

<script>
  let scrollY = 0;
  let targetScrollY = 0;

  window.addEventListener("scroll", () => {
    targetScrollY = window.scrollY;
  });

  function updateParallax() {
    scrollY += (targetScrollY - scrollY) * 0.1;

    document.querySelectorAll(".parallax-section").forEach((section) => {
      const sectionEl = section as HTMLElement;
      const speed = parseFloat(sectionEl.dataset.speed || "0.5");
      const rect = sectionEl.getBoundingClientRect();
      const sectionTop = rect.top + window.scrollY;
      const offset = (scrollY - sectionTop) * speed;

      sectionEl.style.transform = `translateY(${offset}px)`;
    });

    requestAnimationFrame(updateParallax);
  }

  updateParallax();
</script>

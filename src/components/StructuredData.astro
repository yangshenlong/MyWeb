---
/**
 * 结构化数据组件
 * 自动生成 JSON-LD 格式的结构化数据
 */

// ImageMetadata 类型定义在结构化数据中
interface ImageMetadata {
  src: string;
  width: number;
  height: number;
  format: string;
}
import {
	generateWebSiteSchema,
	generateWebPageSchema,
	generateBreadcrumbSchema,
	generateBlogPostingSchema,
	generatePersonSchema,
	generateOrganizationSchema,
} from '../utils/structured-data';

// 基础数据结构类型
type SchemaData =
	| { name: string; description: string; url: string; [key: string]: unknown }
	| { title: string; description: string; url: string; dateModified?: string; [key: string]: unknown }
	| Record<string, unknown>;

interface Props {
	type?: 'website' | 'webpage' | 'blog' | 'breadcrumb' | 'person' | 'organization';
	data?: SchemaData;
}

const { type = 'webpage', data = {} } = Astro.props;

// 根据类型生成相应的结构化数据
let schema: Record<string, unknown> = {};

switch (type) {
	case 'website':
		schema = generateWebSiteSchema(
			data.name,
			data.description,
			data.url
		);
		break;

	case 'webpage':
		schema = generateWebPageSchema(
			data.title,
			data.description,
			data.url,
			data.dateModified
		);
		break;

	case 'blog':
		schema = generateBlogPostingSchema({
			title: data.title,
			description: data.description,
			url: data.url,
			image: data.image,
			datePublished: data.datePublished,
			dateModified: data.dateModified,
			author: data.author,
			tags: data.tags,
			category: data.category,
		});
		break;

	case 'breadcrumb':
		schema = generateBreadcrumbSchema(
			data.items,
			data.baseUrl
		);
		break;

	case 'person':
		schema = generatePersonSchema(data);
		break;

	case 'organization':
		schema = generateOrganizationSchema(data);
		break;

	default:
		schema = data;
}

// 将 schema 转换为 JSON 字符串
const schemaJson = JSON.stringify(schema);
---

<script is:inline set:html={schemaJson} type="application/ld+json" />

---
/**
 * 3D倾斜卡片包装组件
 * 为子元素添加鼠标悬停时的3D倾斜效果
 */

interface Props {
  class?: string;
  maxTilt?: number;
}

const { class: className, maxTilt = 10 } = Astro.props;
---

<div class:list={["tilt-card", className]} data-max-tilt={maxTilt}>
  <slot />
</div>

<style>
  .tilt-card {
    transition: transform 0.1s ease-out;
    transform-style: preserve-3d;
    will-change: transform;
  }

  .tilt-card:hover {
    transform: perspective(1000px) rotateX(var(--tilt-x, 0deg)) rotateY(var(--tilt-y, 0deg))
      scale3d(1.02, 1.02, 1.02);
  }
</style>

<script>
  document.querySelectorAll(".tilt-card").forEach((card) => {
    const cardEl = card as HTMLElement;
    const maxTilt = parseInt(cardEl.dataset.maxTilt || "10");

    cardEl.addEventListener("mousemove", (e: MouseEvent) => {
      const rect = cardEl.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      const centerX = rect.width / 2;
      const centerY = rect.height / 2;

      const tiltX = ((y - centerY) / centerY) * maxTilt;
      const tiltY = ((centerX - x) / centerX) * maxTilt;

      cardEl.style.setProperty("--tilt-x", `${tiltX}deg`);
      cardEl.style.setProperty("--tilt-y", `${tiltY}deg`);
    });

    cardEl.addEventListener("mouseleave", () => {
      cardEl.style.setProperty("--tilt-x", "0deg");
      cardEl.style.setProperty("--tilt-y", "0deg");
    });
  });
</script>

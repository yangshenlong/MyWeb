---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import HeaderArchitectural from '../components/HeaderArchitectural.astro';
import BackToTop from '../components/BackToTop.astro';
import ScrollProgress from '../components/ScrollProgress.astro';
import CursorGlow from '../components/CursorGlow.astro';
import GradientText from '../components/GradientText.astro';
import { SITE_TITLE } from '../consts';

type Props = CollectionEntry<'blog'>['data'] & {
	heroImage?: ImageMetadata | string;
};

const { title, description, pubDate, updatedDate, heroImage, tags, category, author } = Astro.props;

// Format date
const formatDate = (date: Date) => {
	return new Date(date).toLocaleDateString('zh-CN', {
		year: 'numeric',
		month: '2-digit',
		day: '2-digit'
	});
};

const formattedDate = formatDate(pubDate);
const updatedText = updatedDate ? formatDate(updatedDate) : '';
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={title} description={description} />
		<style is:global>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			html {
				scroll-behavior: smooth;
			}

			body {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
				background: #050505;
				color: rgba(255, 255, 255, 0.9);
				line-height: 1.6;
				overflow-x: hidden;
			}

			a {
				color: inherit;
				text-decoration: none;
			}

			::-webkit-scrollbar {
				width: 8px;
			}

			::-webkit-scrollbar-track {
				background: rgba(255, 255, 255, 0.02);
			}

			::-webkit-scrollbar-thumb {
				background: rgba(255, 255, 255, 0.1);
				border-radius: 4px;
			}

			::-webkit-scrollbar-thumb:hover {
				background: rgba(255, 255, 255, 0.2);
			}
		</style>
	</head>

	<body>
		<ScrollProgress />
		<CursorGlow />
		<HeaderArchitectural />

		<!-- Hero Section -->
		<section class="hero-section">
			<div class="hero-content">
				<div class="breadcrumb">
					<span class="breadcrumb-item">
						<a href="/">首页</a>
					</span>
					<span class="breadcrumb-separator">/</span>
					<span class="breadcrumb-item">
						<a href="/blog">技术文章</a>
					</span>
					<span class="breadcrumb-separator">/</span>
					<span class="breadcrumb-item current">{title}</span>
				</div>

				<div class="hero-info">
					<h1 class="hero-title">
						<GradientText>{title}</GradientText>
					</h1>
					{description && (
						<p class="hero-description">{description}</p>
					)}
					<div class="hero-meta">
						<span class="meta-date">{formattedDate}</span>
						{category && <span class="meta-category">{category}</span>}
						{author && <span class="meta-author">{author}</span>}
					</div>
					{tags && tags.length > 0 && (
						<div class="tags-list">
							{tags.map((tag) => (
								<span class="tag">{tag}</span>
							))}
						</div>
					)}
				</div>
			</div>
		</section>

		<!-- Hero Image -->
		{heroImage && (
			<div class="hero-image-wrapper">
				<Image width={1920} height={800} src={heroImage} alt={title} class="hero-image" />
			</div>
		)}

		<!-- Article Content -->
		<main class="article-main">
			<article class="article-content">
				<div class="article-body">
					<slot />
				</div>

				{updatedDate && (
					<div class="updated-info">
						<p>最后更新: {updatedText}</p>
					</div>
				)}
			</article>
		</main>

		<!-- Footer -->
		<footer class="article-footer">
			<div class="footer-content">
				<div class="footer-left">
					<span class="footer-text">© 2024 杨慎龙</span>
					<span class="footer-divider">·</span>
					<span class="footer-text">Technical Artist</span>
				</div>
				<div class="footer-right">
					<a href="https://github.com/yangshenlong" target="_blank" class="footer-link">GitHub</a>
					<a href="https://www.bilibili.com" target="_blank" class="footer-link">Bilibili</a>
					<a href="https://www.zhihu.com" target="_blank" class="footer-link">知乎</a>
				</div>
			</div>
		</footer>

		<BackToTop />

		<style>
			/* Hero Section */
			.hero-section {
				padding: 180px 4em 6em;
				background: #050505;
				position: relative;
			}

			.hero-content {
				max-width: 1600px;
				margin: 0 auto;
			}

			.breadcrumb {
				display: flex;
				align-items: center;
				gap: 0.75em;
				margin-bottom: 2em;
			}

			.breadcrumb-item {
				font-size: 0.75em;
				letter-spacing: 0.2em;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.4);
				transition: color 0.3s ease;
			}

			.breadcrumb-item:hover {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-item.current {
				color: rgba(255, 255, 255, 0.7);
			}

			.breadcrumb-separator {
				color: rgba(255, 255, 255, 0.2);
			}

			.hero-info {
				display: flex;
				flex-direction: column;
				gap: 1.5em;
			}

			.hero-title {
				font-size: clamp(2.5em, 6vw, 5em);
				font-weight: 200;
				letter-spacing: -0.03em;
				line-height: 1.1;
				margin: 0;
			}

			.hero-description {
				font-size: 1.1em;
				color: rgba(255, 255, 255, 0.6);
				line-height: 1.6;
				max-width: 800px;
			}

			.hero-meta {
				display: flex;
				align-items: center;
				gap: 1.5em;
				flex-wrap: wrap;
			}

			.meta-date,
			.meta-category,
			.meta-author {
				font-size: 0.85em;
				color: rgba(255, 255, 255, 0.5);
				font-family: 'Space Mono', monospace;
				letter-spacing: 0.1em;
			}

			.meta-category {
				padding: 0.3em 0.8em;
				background: rgba(255, 255, 255, 0.05);
				border: 1px solid rgba(255, 255, 255, 0.08);
			}

			.tags-list {
				display: flex;
				flex-wrap: wrap;
				gap: 0.75em;
			}

			.tag {
				font-size: 0.75em;
				padding: 0.4em 1em;
				background: rgba(99, 102, 241, 0.15);
				border: 1px solid rgba(99, 102, 241, 0.3);
				color: rgba(199, 198, 255, 0.9);
				border-radius: 4px;
				transition: all 0.3s ease;
			}

			.tag:hover {
				background: rgba(99, 102, 241, 0.25);
				border-color: rgba(99, 102, 241, 0.4);
				transform: translateY(-2px);
			}

			/* Hero Image */
			.hero-image-wrapper {
				width: 100%;
				max-height: 600px;
				overflow: hidden;
				position: relative;
				margin-bottom: 4em;
			}

			.hero-image {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			/* Article Main */
			.article-main {
				padding: 0 4em 8em;
				background: #050505;
			}

			.article-content {
				max-width: 1800px;
				margin: 0 auto;
			}

			.article-body {
				padding: 2em 0;
			}

			/* Content Styles */
			.article-body :global(h1) {
				font-size: 2.5em;
				font-weight: 600;
				color: rgba(255, 255, 255, 0.95);
				margin: 0 0 1em 0;
				padding-bottom: 0.5em;
				border-bottom: 2px solid rgba(99, 102, 241, 0.3);
			}

			.article-body :global(h2) {
				font-size: 2em;
				font-weight: 600;
				color: rgba(255, 255, 255, 0.9);
				margin: 2.5em 0 1em 0;
				padding-left: 0.5em;
				border-left: 4px solid rgba(99, 102, 241, 0.5);
			}

			.article-body :global(h3) {
				font-size: 1.5em;
				font-weight: 500;
				color: rgba(255, 255, 255, 0.85);
				margin: 2em 0 0.8em 0;
			}

			.article-body :global(h4) {
				font-size: 1.25em;
				font-weight: 500;
				color: rgba(255, 255, 255, 0.8);
				margin: 1.5em 0 0.5em 0;
			}

			.article-body :global(p) {
				font-size: 1.05em;
				line-height: 1.8;
				color: rgba(255, 255, 255, 0.8);
				margin-bottom: 1.5em;
			}

			.article-body :global(ul),
			.article-body :global(ol) {
				margin: 1.5em 0;
				padding-left: 2em;
			}

			.article-body :global(li) {
				margin-bottom: 0.5em;
				color: rgba(255, 255, 255, 0.8);
			}

			.article-body :global(code) {
				background: rgba(99, 102, 241, 0.15);
				color: #e0e7ff;
				padding: 0.2em 0.4em;
				border-radius: 4px;
				font-size: 0.9em;
				font-family: 'Space Mono', monospace;
			}

			.article-body :global(pre) {
				background: rgba(0, 0, 0, 0.3);
				border: 1px solid rgba(255, 255, 255, 0.1);
				border-radius: 8px;
				padding: 1.5em;
				overflow-x: auto;
				margin: 1.5em 0;
			}

			.article-body :global(pre code) {
				background: transparent;
				padding: 0;
			}

			.article-body :global(blockquote) {
				border-left: 4px solid rgba(99, 102, 241, 0.5);
				padding: 1em 0 1em 2em;
				margin: 2em 0;
				color: rgba(255, 255, 255, 0.7);
				font-style: italic;
				background: rgba(99, 102, 241, 0.05);
				border-radius: 0 4px 4px 0;
			}

			.article-body :global(img) {
				max-width: 100%;
				height: auto;
				border-radius: 8px;
				margin: 2em 0;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
			}

			.article-body :global(table) {
				width: 100%;
				border-collapse: collapse;
				margin: 2em 0;
				font-size: 0.95em;
			}

			.article-body :global(th),
			.article-body :global(td) {
				padding: 0.75em 1em;
				text-align: left;
				border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			}

			.article-body :global(th) {
				font-weight: 600;
				color: rgba(255, 255, 255, 0.9);
				background: rgba(99, 102, 241, 0.1);
			}

			.article-body :global(a) {
				color: #a78bfa;
				text-decoration: none;
				border-bottom: 1px solid transparent;
				transition: all 0.3s ease;
			}

			.article-body :global(a:hover) {
				color: #c4b5fd;
				border-bottom-color: #c4b5fd;
			}

			/* Updated Info */
			.updated-info {
				text-align: center;
				padding: 2em 0;
				margin-top: 4em;
			}

			.updated-info p {
				font-size: 0.9em;
				color: rgba(255, 255, 255, 0.5);
				font-style: italic;
			}

			/* Footer */
			.article-footer {
				padding: 3em 4em;
				background: #030303;
				border-top: 1px solid rgba(255, 255, 255, 0.05);
			}

			.footer-content {
				display: flex;
				justify-content: space-between;
				align-items: center;
				max-width: 1400px;
				margin: 0 auto;
			}

			.footer-left {
				display: flex;
				align-items: center;
				gap: 1em;
			}

			.footer-text {
				font-size: 0.85em;
				color: rgba(255, 255, 255, 0.4);
			}

			.footer-divider {
				color: rgba(255, 255, 255, 0.2);
			}

			.footer-right {
				display: flex;
				gap: 2em;
			}

			.footer-link {
				font-size: 0.85em;
				color: rgba(255, 255, 255, 0.5);
				transition: color 0.3s ease;
			}

			.footer-link:hover {
				color: rgba(255, 255, 255, 0.8);
			}

			/* Responsive */
			@media (max-width: 1024px) {
				.hero-section {
					padding: 140px 2em 4em;
				}

				.article-main {
					padding: 0 2em 6em;
				}

				.hero-title {
					font-size: 2em;
				}
			}

			@media (max-width: 768px) {
				.hero-section {
					padding: 120px 1.5em 3em;
				}

				.article-main {
					padding: 0 1.5em 4em;
				}

				.article-body {
					padding: 1.5em 0;
				}

				.footer-content {
					flex-direction: column;
					gap: 1.5em;
					text-align: center;
				}

				.hero-meta {
					flex-direction: column;
					align-items: flex-start;
					gap: 0.75em;
				}
			}
		</style>
	</body>
</html>
